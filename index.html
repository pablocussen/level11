<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LEVEL:11 - Sistema gamificado de control digital para conseguir el iPhone 13">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéÆ</text></svg>">
    <title>LEVEL:11 - Digital Wellness Protocol</title>
    <style>
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px currentColor, 0 0 30px rgba(255,0,100,0.3); }
            50% { text-shadow: 0 0 20px currentColor, 0 0 60px rgba(255,0,100,0.5); }
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0f;
            color: white;
            overflow-x: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .background-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(255,0,100,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,0,100,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .vignette {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 0%, #0a0a0f 100%);
            pointer-events: none;
            z-index: 1;
        }

        .scanline {
            position: fixed;
            width: 100%;
            height: 2px;
            background: linear-gradient(transparent, rgba(255,0,100,0.1), transparent);
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 2;
        }

        .container {
            position: relative;
            z-index: 10;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 60px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            animation: slideUp 0.6s ease-out;
        }

        .header-subtitle {
            font-size: 11px;
            color: rgba(255,255,255,0.3);
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        .header-title {
            font-size: clamp(32px, 8vw, 42px);
            font-weight: 300;
            letter-spacing: 8px;
            animation: glow 2s ease-in-out infinite;
            margin: 0;
        }

        .header-title.glitch {
            animation: glitch 0.15s ease-in-out;
            text-shadow: 2px 0 #ff0044, -2px 0 #00ff88;
        }

        .header-level {
            color: #ff3366;
        }

        .header-target {
            margin-top: 8px;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            letter-spacing: 2px;
        }

        .progress-card {
            background: linear-gradient(180deg, rgba(255,0,100,0.1) 0%, rgba(0,0,0,0.8) 100%);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,0,100,0.3);
            position: relative;
            transition: all 0.3s;
            animation: slideUp 0.8s ease-out;
        }

        .progress-card:hover {
            border-color: rgba(255,0,100,0.5);
            box-shadow: 0 0 30px rgba(255,0,100,0.2);
        }

        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            transition: all 0.3s;
        }

        .corner.tl { top: -1px; left: -1px; border-top: 2px solid #ff3366; border-left: 2px solid #ff3366; }
        .corner.tr { top: -1px; right: -1px; border-top: 2px solid #ff3366; border-right: 2px solid #ff3366; }
        .corner.bl { bottom: -1px; left: -1px; border-bottom: 2px solid #ff3366; border-left: 2px solid #ff3366; }
        .corner.br { bottom: -1px; right: -1px; border-bottom: 2px solid #ff3366; border-right: 2px solid #ff3366; }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
            position: relative;
            border-radius: 2px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0066, #ff3366, #ff6699);
            box-shadow: 0 0 20px #ff336666;
            transition: width 1s ease-out;
            position: relative;
        }

        .progress-shine {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .status-box {
            background: rgba(0,0,0,0.6);
            padding: 16px 20px;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s;
            animation: slideUp 1s ease-out;
        }

        .status-text {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 3px;
        }

        .status-info {
            margin-top: 8px;
            font-size: 11px;
            color: rgba(255,255,255,0.4);
        }

        .daily-checkin {
            background: rgba(0,255,136,0.1);
            border: 2px solid #00ff88;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        .checkin-title {
            font-size: 14px;
            letter-spacing: 3px;
            color: #00ff88;
            margin-bottom: 12px;
            text-shadow: 0 0 20px #00ff88;
        }

        .checkin-input {
            width: 80px;
            padding: 10px;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 0 8px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .checkin-input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0,255,136,0.3);
        }

        .checkin-label {
            display: block;
            margin: 12px 0;
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }

        .btn-submit {
            margin-top: 16px;
            padding: 12px 32px;
            background: rgba(0,255,136,0.2);
            border: 2px solid #00ff88;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border-radius: 4px;
        }

        .btn-submit:hover {
            background: rgba(0,255,136,0.3);
            box-shadow: 0 0 30px rgba(0,255,136,0.5);
            transform: translateY(-2px);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 24px;
        }

        .nav-btn {
            padding: 20px 12px;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.4);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            border-radius: 4px;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255,255,255,0.1);
        }

        .nav-btn.purple {
            border-color: rgba(138,43,226,0.5);
            color: #aa66ff;
        }

        .nav-btn.purple:hover {
            box-shadow: 0 4px 20px rgba(138,43,226,0.3);
            border-color: #aa66ff;
        }

        .nav-icon {
            font-size: 20px;
        }

        .target-section {
            margin-top: 24px;
            text-align: center;
            padding: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .target-label {
            font-size: 10px;
            color: rgba(255,255,255,0.3);
            letter-spacing: 2px;
            margin-bottom: 4px;
        }

        .target-date {
            font-size: 16px;
            color: #ff3366;
            letter-spacing: 4px;
            font-weight: 500;
            text-shadow: 0 0 20px rgba(255,0,100,0.5);
            animation: float 3s ease-in-out infinite;
        }

        .target-status {
            margin-top: 8px;
            font-size: 11px;
            color: rgba(255,255,255,0.4);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            animation: fadeIn 0.3s;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #0a0a0f;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255,0,100,0.5);
            position: relative;
            animation: slideUp 0.3s;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 4px;
        }

        .modal-title {
            font-size: 12px;
            letter-spacing: 3px;
            color: #ff3366;
            margin-bottom: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .btn-cancel {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.6);
        }

        .btn-cancel:hover {
            border-color: rgba(255,255,255,0.6);
            color: #fff;
        }

        .btn-confirm {
            background: rgba(0,255,136,0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }

        .btn-confirm:hover {
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
            transform: translateY(-2px);
        }

        .achievement-item {
            background: rgba(0,0,0,0.4);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
            opacity: 0.4;
            transition: all 0.3s;
            border-radius: 4px;
        }

        .achievement-item:hover {
            transform: translateX(4px);
        }

        .achievement-item.unlocked {
            background: rgba(138,43,226,0.1);
            border-color: rgba(138,43,226,0.5);
            opacity: 1;
        }

        .achievement-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .achievement-icon.unlocked {
            color: #aa66ff;
            text-shadow: 0 0 15px rgba(138,43,226,0.8);
            animation: celebration 0.5s;
        }

        .back-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 16px;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .back-btn:hover {
            border-color: rgba(255,255,255,0.6);
            color: #fff;
            transform: translateX(-4px);
        }

        .view-title {
            font-size: 20px;
            font-weight: 300;
            margin-bottom: 24px;
            text-align: center;
            letter-spacing: 4px;
        }

        .motivational-msg {
            background: rgba(255,170,0,0.1);
            border: 1px solid rgba(255,170,0,0.3);
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 13px;
            color: #ffaa00;
            letter-spacing: 1px;
            line-height: 1.6;
            border-radius: 4px;
            animation: slideUp 1.2s ease-out;
        }

        .hidden {
            display: none;
        }

        /* Loading screen */
        .loading {
            position: fixed;
            inset: 0;
            background: #0a0a0f;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,0,100,0.3);
            border-top-color: #ff3366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile UX Optimizations */
        html {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            -webkit-tap-highlight-color: rgba(170,102,255,0.3);
        }

        /* Prevent zoom on input focus (mobile) */
        input, select, textarea, button {
            font-size: 16px;
        }

        /* Better touch targets */
        button, .btn-submit, .nav-btn, .back-btn {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .checkin-input {
            min-height: 44px;
            touch-action: manipulation;
        }

        /* Smooth transitions for mobile */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 12px;
                padding-bottom: 40px;
            }

            .header-title {
                font-size: 28px;
                letter-spacing: 4px;
            }

            .progress-card {
                padding: 16px;
            }

            .progress-stats {
                font-size: 10px;
                gap: 6px;
            }

            .nav-grid {
                gap: 10px;
                margin: 16px 0;
            }

            .nav-btn {
                padding: 20px 12px;
                font-size: 11px;
                min-height: 60px;
            }

            .nav-icon {
                font-size: 20px;
                margin-bottom: 6px;
            }

            .daily-checkin {
                padding: 16px;
            }

            .checkin-input {
                width: 70px;
                padding: 12px 8px;
                font-size: 16px;
            }

            .btn-submit {
                width: 100%;
                padding: 16px 24px;
                font-size: 14px;
                letter-spacing: 2px;
            }

            .achievement-item {
                padding: 14px;
            }

            .achievement-icon {
                font-size: 28px;
                width: 50px;
                height: 50px;
            }

            .history-item {
                padding: 14px;
            }

            .stat-card {
                padding: 14px;
            }

            /* Daily Challenge mobile optimizations */
            .daily-challenge-box {
                padding: 14px;
            }

            .daily-challenge-box button {
                padding: 14px 12px;
                font-size: 14px;
                min-height: 48px;
            }

            .daily-challenge-box input {
                padding: 14px 12px;
                font-size: 16px;
                min-height: 48px;
            }

            /* Memory pattern buttons */
            #pattern-buttons button {
                font-size: 28px;
                padding: 16px 20px;
                margin: 6px;
                min-width: 60px;
                min-height: 60px;
            }
        }

        /* Extra small screens */
        @media (max-width: 400px) {
            .container {
                padding: 10px;
            }

            .header-title {
                font-size: 24px;
                letter-spacing: 3px;
            }

            .progress-stats {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-btn {
                padding: 18px 8px;
                font-size: 10px;
            }

            .checkin-input {
                width: 60px;
            }
        }

        /* Landscape mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            .container {
                max-width: 800px;
            }

            .nav-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Print styles */
        @media print {
            .background-grid, .vignette, .scanline {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- Background effects -->
    <div class="background-grid"></div>
    <div class="vignette"></div>
    <div class="scanline"></div>

    <!-- Main container -->
    <div class="container" id="app"></div>

    <script>
        // Configuration
        const CONFIG = {
            START_DATE: new Date('2026-01-01'),
            TARGET_DATE: new Date('2026-03-12'),
            TARGET_LEVEL: 60,
            XP_PER_LEVEL: 100,
            SECRET_CODE: "1983HAWKINS",
            VERSION: "2.3.2"
        };

        // Sound System (Web Audio API - No external files needed)
        const SoundSystem = {
            ctx: null,
            enabled: true,

            init() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.enabled = localStorage.getItem('soundEnabled') !== 'false';
            },

            toggle() {
                this.enabled = !this.enabled;
                localStorage.setItem('soundEnabled', this.enabled);
                return this.enabled;
            },

            play(type) {
                if (!this.enabled || !this.ctx) return;

                const sounds = {
                    click: () => this.beep(800, 0.05, 0.1),
                    success: () => this.successSound(),
                    levelUp: () => this.levelUpSound(),
                    achievement: () => this.achievementSound(),
                    streak: () => this.streakSound(),
                    warning: () => this.warningSound()
                };

                if (sounds[type]) sounds[type]();
            },

            beep(freq, duration, volume = 0.3) {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.frequency.value = freq;
                osc.type = 'sine';

                gain.gain.setValueAtTime(volume, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);

                osc.start(this.ctx.currentTime);
                osc.stop(this.ctx.currentTime + duration);
            },

            successSound() {
                this.beep(523.25, 0.1, 0.2); // C5
                setTimeout(() => this.beep(659.25, 0.1, 0.2), 100); // E5
                setTimeout(() => this.beep(783.99, 0.15, 0.25), 200); // G5
            },

            levelUpSound() {
                const notes = [261.63, 329.63, 392, 523.25]; // C4, E4, G4, C5
                notes.forEach((freq, i) => {
                    setTimeout(() => this.beep(freq, 0.15, 0.3), i * 100);
                });
            },

            achievementSound() {
                this.beep(880, 0.1, 0.25);
                setTimeout(() => this.beep(1046.5, 0.2, 0.3), 100);
            },

            streakSound() {
                this.beep(440, 0.08, 0.15);
                setTimeout(() => this.beep(554.37, 0.08, 0.15), 80);
                setTimeout(() => this.beep(659.25, 0.12, 0.2), 160);
            },

            warningSound() {
                this.beep(220, 0.15, 0.2);
                setTimeout(() => this.beep(196, 0.15, 0.2), 150);
            }
        };

        // State
        const state = {
            currentView: 'main',
            level: 1,
            xp: 0,
            streak: 0,
            totalDays: 0,
            secretFound: false,
            todayCheckedIn: false,
            history: [],
            weeklyRoblox: 0,
            currentWeek: getCurrentWeek(),
            dailyChallenge: {
                completed: false,
                bonusMinutes: 0,
                attempts: 3,
                lastDate: null
            },
            achievements: {
                first_login: false,
                streak_3: false,
                streak_7: false,
                streak_14: false,
                streak_30: false,
                level_10: false,
                level_25: false,
                level_50: false,
                level_75: false,
                perfect_week: false,
                mindflayer: false,
                the_upside: false
            },
            todayStats: {
                tiktok: 0,
                instagram: 0,
                roblox: 0,
                unlocks: 0
            },
            limits: {
                tiktok: 15,
                instagram: 15,
                roblox: 120,
                unlocks: 50
            }
        };

        // Daily Challenges Database
        const DAILY_CHALLENGES = {
            animal_trivia: [
                { q: '¬øCu√°l es el animal m√°s r√°pido del mundo?', options: ['Le√≥n', 'Guepardo', 'Halc√≥n peregrino', 'Tibur√≥n'], answer: 2 },
                { q: '¬øQu√© animal puede dormir de pie?', options: ['Elefante', 'Caballo', 'Jirafa', 'Vaca'], answer: 1 },
                { q: '¬øCu√°ntos corazones tiene un pulpo?', options: ['1', '2', '3', '5'], answer: 2 },
                { q: '¬øQu√© animal es el m√°s grande del planeta?', options: ['Elefante africano', 'Ballena azul', 'Tibur√≥n ballena', 'Jirafa'], answer: 1 },
                { q: '¬øLos delfines duermen con un ojo abierto?', options: ['S√≠', 'No'], answer: 0 },
                { q: '¬øQu√© animal tiene la lengua m√°s larga?', options: ['Oso hormiguero', 'Jirafa', 'Camale√≥n', 'Serpiente'], answer: 1 },
                { q: '¬øLas mariposas pueden probar con sus patas?', options: ['S√≠', 'No'], answer: 0 }
            ],
            math_quick: [
                { q: '¬øCu√°nto es 15 √ó 4?', answer: '60' },
                { q: '¬øCu√°nto es 144 √∑ 12?', answer: '12' },
                { q: '¬øCu√°nto es 25 + 37?', answer: '62' },
                { q: '¬øCu√°nto es 100 - 48?', answer: '52' },
                { q: '¬øCu√°nto es 8 √ó 9?', answer: '72' },
                { q: '¬øCu√°nto es 56 √∑ 7?', answer: '8' },
                { q: '¬øCu√°nto es 33 + 29?', answer: '62' }
            ],
            riddles: [
                { q: 'Blanca por dentro, verde por fuera. Si quieres que te lo diga, espera.', answer: 'pera' },
                { q: 'Tengo agujas pero no coso, tengo n√∫meros pero no cuento. ¬øQu√© soy?', answer: 'reloj' },
                { q: 'Cuanto m√°s seca, m√°s se moja. ¬øQu√© es?', answer: 'toalla' },
                { q: 'Oro parece, plata no es. ¬øQu√© es?', answer: 'platano' },
                { q: 'Vuelo de noche, duermo de d√≠a, y nunca ver√°s plumas en ala m√≠a.', answer: 'murcielago' },
                { q: 'Tiene dientes pero no muerde. ¬øQu√© es?', answer: 'peine' },
                { q: 'Choco con la pared y reboto. ¬øQu√© soy?', answer: 'pelota' }
            ],
            universe_trivia: [
                { q: '¬øCu√°ntos planetas hay en el sistema solar?', options: ['7', '8', '9', '10'], answer: 1 },
                { q: '¬øCu√°l es el planeta m√°s grande?', options: ['Saturno', 'Neptuno', 'J√∫piter', 'Urano'], answer: 2 },
                { q: '¬øQu√© planeta es conocido como el planeta rojo?', options: ['Venus', 'Marte', 'Mercurio', 'J√∫piter'], answer: 1 },
                { q: '¬øLa Tierra gira alrededor del Sol o el Sol alrededor de la Tierra?', options: ['Tierra alrededor del Sol', 'Sol alrededor de la Tierra'], answer: 0 },
                { q: '¬øCu√°nto tarda la luz del Sol en llegar a la Tierra?', options: ['8 segundos', '8 minutos', '8 horas', '8 d√≠as'], answer: 1 },
                { q: '¬øQu√© hay m√°s en el universo?', options: ['Estrellas', 'Planetas', 'Galaxias', 'Lunas'], answer: 0 },
                { q: '¬øLos anillos de Saturno est√°n hechos de...?', options: ['Gas', 'Roca', 'Hielo y roca', 'Polvo'], answer: 2 }
            ],
            word_scramble: [
                { q: 'Desordena esta palabra: ELEFANTE', scrambled: 'TEENFALE', answer: 'elefante' },
                { q: 'Desordena esta palabra: COMPUTADORA', scrambled: 'ROADATUPCOM', answer: 'computadora' },
                { q: 'Desordena esta palabra: MARIPOSA', scrambled: 'SOAMIRAP', answer: 'mariposa' },
                { q: 'Desordena esta palabra: TELEFONO', scrambled: 'NOFOTELE', answer: 'telefono' },
                { q: 'Desordena esta palabra: CHOCOLATE', scrambled: 'TEOCOHACL', answer: 'chocolate' }
            ],
            memory_pattern: [
                { pattern: ['üî¥', 'üîµ', 'üü¢'], length: 3 },
                { pattern: ['üî¥', 'üîµ', 'üî¥', 'üü¢'], length: 4 },
                { pattern: ['üîµ', 'üü¢', 'üî¥', 'üîµ', 'üü¢'], length: 5 },
                { pattern: ['üü¢', 'üî¥', 'üîµ', 'üî¥', 'üü¢', 'üîµ'], length: 6 }
            ],
            quick_trivia: [
                { q: '¬øCu√°l es la capital de Francia?', options: ['Londres', 'Berl√≠n', 'Par√≠s', 'Madrid'], answer: 2 },
                { q: '¬øCu√°ntos continentes hay?', options: ['5', '6', '7', '8'], answer: 2 },
                { q: '¬øEl agua hierve a...?', options: ['50¬∞C', '100¬∞C', '150¬∞C', '200¬∞C'], answer: 1 },
                { q: '¬øCu√°ntos d√≠as tiene un a√±o?', options: ['360', '365', '366', '370'], answer: 1 },
                { q: '¬øDe qu√© color es el cielo en un d√≠a despejado?', options: ['Verde', 'Rojo', 'Azul', 'Amarillo'], answer: 2 }
            ]
        };

        // Motivational messages
        const MOTIVATIONAL_MESSAGES = [
            "¬°Excelente trabajo! Mant√©n el control digital üéÆ",
            "Cada d√≠a est√°s m√°s cerca del iPhone 13 üì±",
            "Tu disciplina es incre√≠ble. ¬°Sigue as√≠! ‚ö°",
            "Los buenos h√°bitos construyen un gran futuro üåü",
            "¬°Est√°s demostrando un autocontrol impresionante! üí™",
            "Paso a paso, d√≠a a d√≠a, lo est√°s logrando üöÄ",
            "Tu progreso es inspirador. ¬°No pares! ‚ú®",
            "Cada racha ganada es un paso hacia tu meta üî•"
        ];

        // Utility functions
        function getCurrentWeek() {
            const now = new Date();
            const onejan = new Date(now.getFullYear(), 0, 1);
            return Math.ceil((((now - onejan) / 86400000) + onejan.getDay() + 1) / 7);
        }

        function getTodayKey() {
            const now = new Date();
            return `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
        }

        function getDaysSinceStart() {
            const now = new Date();
            const diff = now - CONFIG.START_DATE;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        function getDaysUntilTarget() {
            const now = new Date();
            const diff = CONFIG.TARGET_DATE - now;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        function getStatus(current, limit) {
            const ratio = current / limit;
            if (ratio <= 1) return 'good';
            if (ratio <= 1.2) return 'warning';
            return 'critical';
        }

        function getDayStatus() {
            const bonusMinutes = state.dailyChallenge.bonusMinutes || 0;
            const statuses = [
                getStatus(state.todayStats.tiktok, state.limits.tiktok + bonusMinutes),
                getStatus(state.todayStats.instagram, state.limits.instagram + bonusMinutes),
                getStatus(state.weeklyRoblox, state.limits.roblox),
                getStatus(state.todayStats.unlocks, state.limits.unlocks)
            ];
            if (statuses.some(s => s === 'critical')) return 'breach';
            if (statuses.some(s => s === 'warning')) return 'alert';
            return 'stable';
        }

        function getStatusColor(status) {
            return {
                good: '#00ff88',
                warning: '#ffaa00',
                critical: '#ff0044'
            }[status];
        }

        // Daily Challenge Functions
        function getDailyChallengeType() {
            const types = ['animal_trivia', 'math_quick', 'riddles', 'universe_trivia', 'word_scramble', 'memory_pattern', 'quick_trivia'];
            const today = new Date();
            const dayIndex = Math.floor((today - CONFIG.START_DATE) / (1000 * 60 * 60 * 24));
            return types[dayIndex % types.length];
        }

        function getTodayChallenge() {
            const challengeType = getDailyChallengeType();
            const challenges = DAILY_CHALLENGES[challengeType];
            const today = new Date();
            const dayIndex = Math.floor((today - CONFIG.START_DATE) / (1000 * 60 * 60 * 24));
            const challengeIndex = dayIndex % challenges.length;
            return {
                type: challengeType,
                data: challenges[challengeIndex]
            };
        }

        function resetDailyChallengeIfNeeded() {
            const todayKey = getTodayKey();
            if (state.dailyChallenge.lastDate !== todayKey) {
                state.dailyChallenge.completed = false;
                state.dailyChallenge.bonusMinutes = 0;
                state.dailyChallenge.attempts = 3;
                state.dailyChallenge.lastDate = todayKey;
                // saveState() is called at the end of render()
            }
        }

        function checkChallengeAnswer(answer) {
            if (state.dailyChallenge.completed || state.dailyChallenge.attempts <= 0) {
                return { success: false, message: 'Ya no hay intentos disponibles' };
            }

            const challenge = getTodayChallenge();
            let isCorrect = false;

            if (challenge.type === 'animal_trivia' || challenge.type === 'universe_trivia' || challenge.type === 'quick_trivia') {
                isCorrect = parseInt(answer) === challenge.data.answer;
            } else if (challenge.type === 'math_quick' || challenge.type === 'riddles' || challenge.type === 'word_scramble') {
                isCorrect = answer.toLowerCase().trim() === challenge.data.answer.toLowerCase().trim();
            } else if (challenge.type === 'memory_pattern') {
                isCorrect = answer === challenge.data.pattern.join(',');
            }

            state.dailyChallenge.attempts--;

            if (isCorrect) {
                state.dailyChallenge.completed = true;
                state.dailyChallenge.bonusMinutes = 10;
                SoundSystem.play('achievement');
                saveState();
                return {
                    success: true,
                    message: '¬°CORRECTO! üéâ Ganaste +10 minutos extra para hoy',
                    bonusMinutes: 10
                };
            } else {
                saveState();
                if (state.dailyChallenge.attempts > 0) {
                    return {
                        success: false,
                        message: `Incorrecto. Te quedan ${state.dailyChallenge.attempts} intentos.`
                    };
                } else {
                    return {
                        success: false,
                        message: 'Se acabaron los intentos. Int√©ntalo ma√±ana.'
                    };
                }
            }
        }

        function calculateXP(stats) {
            let xp = 0;

            // Apply bonus minutes from Daily Challenge
            const bonusMinutes = state.dailyChallenge.bonusMinutes || 0;
            const tiktokLimit = state.limits.tiktok + bonusMinutes;
            const instagramLimit = state.limits.instagram + bonusMinutes;

            if (stats.tiktok <= tiktokLimit) xp += 30;
            if (stats.instagram <= instagramLimit) xp += 30;
            if (state.weeklyRoblox <= state.limits.roblox) xp += 30;
            if (stats.unlocks <= state.limits.unlocks) xp += 10;

            if (stats.tiktok <= tiktokLimit * 0.5) xp += 20;
            if (stats.instagram <= instagramLimit * 0.5) xp += 20;
            if (state.weeklyRoblox <= state.limits.roblox * 0.5) xp += 20;

            if (getDayStatus() === 'stable' &&
                stats.tiktok <= tiktokLimit * 0.7 &&
                stats.instagram <= instagramLimit * 0.7 &&
                state.weeklyRoblox <= state.limits.roblox * 0.7) {
                xp += 50;
            }

            return xp;
        }

        function checkLevelUp() {
            const newLevel = Math.floor(state.xp / CONFIG.XP_PER_LEVEL) + 1;

            if (newLevel > state.level) {
                state.level = newLevel;
                SoundSystem.play('levelUp');
                vibrate([100, 50, 100, 50, 200]); // Level up celebration pattern
                checkAchievements();
                showCelebration(`¬°SUBISTE A NIVEL ${state.level}!`, `Ganaste +${(newLevel - state.level) * 100} XP`);
                return true;
            }
            return false;
        }

        function checkAchievements() {
            const oldAchievements = {...state.achievements};

            if (state.level >= 10) state.achievements.level_10 = true;
            if (state.level >= 25) state.achievements.level_25 = true;
            if (state.level >= 50) state.achievements.level_50 = true;
            if (state.level >= 75) state.achievements.level_75 = true;

            if (state.streak >= 3) state.achievements.streak_3 = true;
            if (state.streak >= 7) state.achievements.streak_7 = true;
            if (state.streak >= 14) state.achievements.streak_14 = true;
            if (state.streak >= 30) state.achievements.streak_30 = true;

            const lastWeek = state.history.slice(-7);
            if (lastWeek.length === 7 && lastWeek.every(d => d.status === 'stable')) {
                state.achievements.perfect_week = true;
            }

            if (state.level >= 60) state.achievements.mindflayer = true;
            if (state.secretFound) state.achievements.the_upside = true;
            state.achievements.first_login = true;

            for (let key in state.achievements) {
                if (state.achievements[key] && !oldAchievements[key]) {
                    const achievement = getAchievementData(key);
                    setTimeout(() => {
                        SoundSystem.play('achievement');
                        vibrate([50, 30, 50, 30, 50]); // Achievement unlock pattern
                        showCelebration(`¬°LOGRO DESBLOQUEADO!`, achievement.name);
                    }, 500);
                }
            }

            // Play streak sound if streak increased
            if (state.streak > 0 && state.streak !== oldAchievements.streak) {
                SoundSystem.play('streak');
                vibrate([30, 20, 30]); // Streak celebration
            }
        }

        function getAchievementData(key) {
            const achievements = {
                first_login: { name: "FIRST_LOGIN", desc: "Sistema iniciado", icon: "‚óà" },
                streak_3: { name: "FIREWALL", desc: "3 d√≠as consecutivos", icon: "‚óâ" },
                streak_7: { name: "STREAK_7", desc: "7 d√≠as consecutivos", icon: "‚ñ≤" },
                streak_14: { name: "FORTITUDE", desc: "14 d√≠as consecutivos", icon: "‚¨¢" },
                streak_30: { name: "CHAMPION", desc: "30 d√≠as consecutivos", icon: "‚òÖ" },
                level_10: { name: "EXPLORER", desc: "Alcanzar nivel 10", icon: "‚óé" },
                level_25: { name: "WARRIOR", desc: "Alcanzar nivel 25", icon: "‚¨°" },
                level_50: { name: "HERO", desc: "Alcanzar nivel 50", icon: "‚óÜ" },
                level_75: { name: "LEGEND", desc: "Alcanzar nivel 75 - iPhone desbloqueado!", icon: "‚ôî" },
                perfect_week: { name: "PERFECT_WEEK", desc: "7 d√≠as perfectos seguidos", icon: "‚ú¶" },
                mindflayer: { name: "MINDFLAYER", desc: "Superar el nivel 60", icon: "‚úß" },
                the_upside: { name: "THE_UPSIDE", desc: "Descifrar el c√≥digo oculto", icon: "‚üÅ" }
            };
            return achievements[key] || {};
        }

        // Check-in
        function submitDailyCheckin() {
            const tiktok = parseInt(document.getElementById('input-tiktok').value) || 0;
            const instagram = parseInt(document.getElementById('input-instagram').value) || 0;
            const roblox = parseInt(document.getElementById('input-roblox').value) || 0;
            const unlocks = parseInt(document.getElementById('input-unlocks').value) || 0;

            const currentWeek = getCurrentWeek();
            if (currentWeek !== state.currentWeek) {
                state.weeklyRoblox = 0;
                state.currentWeek = currentWeek;
            }

            state.weeklyRoblox += roblox;
            state.todayStats = { tiktok, instagram, roblox, unlocks };

            const xpGained = calculateXP(state.todayStats);
            state.xp += xpGained;

            const dayStatus = getDayStatus();

            const yesterday = state.history[state.history.length - 1];
            if (yesterday && yesterday.date === getTodayKey()) {
                state.history[state.history.length - 1] = {
                    date: getTodayKey(),
                    stats: {...state.todayStats},
                    status: dayStatus,
                    xp: xpGained
                };
            } else {
                if (dayStatus === 'stable' || dayStatus === 'alert') {
                    state.streak++;
                } else {
                    state.streak = 0;
                }

                state.history.push({
                    date: getTodayKey(),
                    stats: {...state.todayStats},
                    status: dayStatus,
                    xp: xpGained
                });

                state.totalDays++;
            }

            state.todayCheckedIn = true;

            const leveledUp = checkLevelUp();
            checkAchievements();
            saveState();

            // Play sounds and haptic feedback based on day status
            if (dayStatus === 'stable') {
                SoundSystem.play('success');
                vibrate([70, 30, 100]); // Perfect day pattern
            } else if (dayStatus === 'breach') {
                SoundSystem.play('warning');
                vibrate([200]); // Warning buzz
            } else {
                SoundSystem.play('click');
                vibrate(50); // Gentle confirmation
            }

            showCelebration(
                `¬°CHECK-IN COMPLETADO!`,
                `Ganaste ${xpGained} XP | Estado: ${dayStatus === 'stable' ? 'PERFECTO ‚ú®' : dayStatus === 'alert' ? 'BIEN ‚ö†Ô∏è' : 'MEJORAR üî¥'}`
            );

            render();
        }

        // Render functions (continuing in next message due to length...)

        function renderDailyCheckin() {
            if (state.todayCheckedIn) {
                const dayStatus = getDayStatus();
                const statusConfig = {
                    stable: { color: '#00ff88', text: 'D√çA PERFECTO ‚ú®', msg: 'Excelente control digital' },
                    alert: { color: '#ffaa00', text: 'BUEN TRABAJO ‚ö†Ô∏è', msg: 'Casi perfecto, sigue as√≠' },
                    breach: { color: '#ff0044', text: 'MEJORAR MA√ëANA üî¥', msg: 'Intenta reducir el uso ma√±ana' }
                }[dayStatus];

                return `
                    <div class="status-box" style="border: 1px solid ${statusConfig.color}33; box-shadow: 0 0 30px ${statusConfig.color}44; background: rgba(0,0,0,0.8);">
                        <div class="status-text" style="color: ${statusConfig.color}; text-shadow: 0 0 20px ${statusConfig.color};">
                            ${statusConfig.text}
                        </div>
                        <div class="status-info" style="margin-top: 12px; font-size: 12px;">
                            ${statusConfig.msg}
                        </div>
                        <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                            <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 8px;">Resumen de hoy:</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.8);">
                                TikTok: ${state.todayStats.tiktok}/${state.limits.tiktok} min |
                                IG: ${state.todayStats.instagram}/${state.limits.instagram} min<br/>
                                Roblox: ${state.todayStats.roblox} min (${state.weeklyRoblox}/${state.limits.roblox} semanal) |
                                Desbloqueos: ${state.todayStats.unlocks}/${state.limits.unlocks}
                            </div>
                        </div>
                    </div>
                `;
            }

            const bonusMinutes = state.dailyChallenge.bonusMinutes || 0;
            const bonusText = bonusMinutes > 0 ? ` <span style="color: #00ff88;">+${bonusMinutes} üéâ</span>` : '';

            return `
                <div class="daily-checkin">
                    <div class="checkin-title">‚óà CHECK-IN DIARIO ‚óà</div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-bottom: 16px;">
                        Reporta tu uso de hoy con honestidad
                    </div>

                    <div style="margin: 16px 0;">
                        <div class="checkin-label">
                            <span style="color: #ff006e;">‚ñ∂</span> TikTok (minutos hoy):
                            <input type="number" id="input-tiktok" class="checkin-input" min="0" max="999" value="0" />
                            <span style="font-size: 10px; color: rgba(255,255,255,0.4);">/ ${state.limits.tiktok}${bonusText} diario</span>
                        </div>
                    </div>

                    <div style="margin: 16px 0;">
                        <div class="checkin-label">
                            <span style="color: #00d4ff;">‚óé</span> Instagram (minutos hoy):
                            <input type="number" id="input-instagram" class="checkin-input" min="0" max="999" value="0" />
                            <span style="font-size: 10px; color: rgba(255,255,255,0.4);">/ ${state.limits.instagram}${bonusText} diario</span>
                        </div>
                    </div>

                    <div style="margin: 16px 0;">
                        <div class="checkin-label">
                            <span style="color: #ffa500;">üéÆ</span> Roblox (minutos hoy):
                            <input type="number" id="input-roblox" class="checkin-input" min="0" max="999" value="0" />
                            <span style="font-size: 10px; color: rgba(255,255,255,0.4);">
                                ${state.weeklyRoblox}/${state.limits.roblox} esta semana
                            </span>
                        </div>
                    </div>

                    <div style="margin: 16px 0;">
                        <div class="checkin-label">
                            <span style="color: #00ff88;">‚óá</span> Desbloqueos del celular:
                            <input type="number" id="input-unlocks" class="checkin-input" min="0" max="999" value="0" />
                            <span style="font-size: 10px; color: rgba(255,255,255,0.4);">/ ${state.limits.unlocks}</span>
                        </div>
                    </div>

                    <button class="btn-submit" onclick="submitDailyCheckin()">
                        ‚úì REGISTRAR D√çA
                    </button>

                    <div style="margin-top: 12px; font-size: 10px; color: rgba(255,255,255,0.4); font-style: italic;">
                        La honestidad es clave para alcanzar tu meta üéØ
                    </div>
                </div>
            `;
        }

        function renderDailyChallenge() {
            resetDailyChallengeIfNeeded();
            const challenge = getTodayChallenge();
            const challengeNames = {
                animal_trivia: 'ü¶Å Trivia de Animales',
                math_quick: 'üßÆ Matem√°ticas R√°pidas',
                riddles: 'ü§î Adivinanza',
                universe_trivia: 'üåå Trivia del Universo',
                word_scramble: 'üî§ Palabra Desordenada',
                memory_pattern: 'üß† Memoria de Patrones',
                quick_trivia: '‚ö° Trivia R√°pida'
            };

            if (state.dailyChallenge.completed) {
                return `
                    <div class="daily-challenge-box completed" style="
                        border: 1px solid #00ff8833;
                        background: rgba(0,255,136,0.05);
                        padding: 16px;
                        margin: 16px 0;
                        border-radius: 8px;
                    ">
                        <div style="font-size: 12px; color: #00ff88; font-weight: bold; margin-bottom: 8px;">
                            ‚úì DESAF√çO COMPLETADO
                        </div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.6);">
                            Ganaste +10 minutos extra para hoy üéâ
                        </div>
                    </div>
                `;
            }

            if (state.dailyChallenge.attempts <= 0) {
                return `
                    <div class="daily-challenge-box failed" style="
                        border: 1px solid rgba(255,255,255,0.1);
                        background: rgba(0,0,0,0.6);
                        padding: 16px;
                        margin: 16px 0;
                        border-radius: 8px;
                    ">
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); font-weight: bold; margin-bottom: 8px;">
                            DESAF√çO DIARIO
                        </div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.4);">
                            Sin intentos disponibles. Vuelve ma√±ana.
                        </div>
                    </div>
                `;
            }

            let challengeHTML = '';

            if (challenge.type === 'animal_trivia' || challenge.type === 'universe_trivia' || challenge.type === 'quick_trivia') {
                challengeHTML = `
                    <div style="font-size: 13px; color: #fff; margin-bottom: 16px; line-height: 1.4;">
                        ${challenge.data.q}
                    </div>
                    ${challenge.data.options.map((opt, idx) => `
                        <button onclick="submitChallengeAnswer(${idx})" style="
                            width: 100%;
                            padding: 12px;
                            margin: 6px 0;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.2);
                            color: #fff;
                            font-family: 'Courier New', monospace;
                            font-size: 12px;
                            cursor: pointer;
                            border-radius: 4px;
                            transition: all 0.3s;
                            text-align: left;
                        " onmouseover="this.style.background='rgba(170,102,255,0.2)'; this.style.borderColor='#aa66ff'"
                           onmouseout="this.style.background='rgba(255,255,255,0.05)'; this.style.borderColor='rgba(255,255,255,0.2)'">
                            ${String.fromCharCode(65 + idx)}. ${opt}
                        </button>
                    `).join('')}
                `;
            } else if (challenge.type === 'math_quick' || challenge.type === 'riddles' || challenge.type === 'word_scramble') {
                const displayText = challenge.type === 'word_scramble'
                    ? `${challenge.data.q}<br/><span style="color: #aa66ff; font-size: 16px; letter-spacing: 3px;">${challenge.data.scrambled}</span>`
                    : challenge.data.q;

                challengeHTML = `
                    <div style="font-size: 13px; color: #fff; margin-bottom: 16px; line-height: 1.4;">
                        ${displayText}
                    </div>
                    <input type="text" id="challenge-answer" placeholder="Escribe tu respuesta..." style="
                        width: 100%;
                        padding: 12px;
                        background: rgba(0,0,0,0.6);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: #fff;
                        font-family: 'Courier New', monospace;
                        font-size: 14px;
                        border-radius: 4px;
                        margin-bottom: 12px;
                    " />
                    <button onclick="submitChallengeAnswerText()" style="
                        width: 100%;
                        padding: 12px;
                        background: rgba(170,102,255,0.2);
                        border: 1px solid #aa66ff;
                        color: #aa66ff;
                        font-family: 'Courier New', monospace;
                        font-size: 12px;
                        font-weight: bold;
                        cursor: pointer;
                        border-radius: 4px;
                        transition: all 0.3s;
                    " onmouseover="this.style.background='rgba(170,102,255,0.3)'"
                       onmouseout="this.style.background='rgba(170,102,255,0.2)'">
                        ‚úì ENVIAR RESPUESTA
                    </button>
                `;
            } else if (challenge.type === 'memory_pattern') {
                challengeHTML = `
                    <div style="font-size: 13px; color: #fff; margin-bottom: 16px;">
                        Memoriza este patr√≥n (desaparecer√° en 5 segundos):
                    </div>
                    <div id="memory-pattern" style="font-size: 32px; text-align: center; margin: 20px 0;">
                        ${challenge.data.pattern.join(' ')}
                    </div>
                    <div id="memory-input" style="display: none;">
                        <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 12px;">
                            Reproduce el patr√≥n:
                        </div>
                        <div id="pattern-buttons" style="text-align: center; margin-bottom: 16px;">
                            <button onclick="addToPattern('üî¥')" style="font-size: 24px; padding: 12px 16px; margin: 4px; background: rgba(255,0,0,0.2); border: 1px solid #ff0000; border-radius: 50%; cursor: pointer;">üî¥</button>
                            <button onclick="addToPattern('üîµ')" style="font-size: 24px; padding: 12px 16px; margin: 4px; background: rgba(0,0,255,0.2); border: 1px solid #0000ff; border-radius: 50%; cursor: pointer;">üîµ</button>
                            <button onclick="addToPattern('üü¢')" style="font-size: 24px; padding: 12px 16px; margin: 4px; background: rgba(0,255,0,0.2); border: 1px solid #00ff00; border-radius: 50%; cursor: pointer;">üü¢</button>
                        </div>
                        <div id="user-pattern" style="font-size: 24px; text-align: center; margin: 16px 0; min-height: 40px; color: #aa66ff;"></div>
                        <button onclick="clearPattern()" style="padding: 8px 16px; margin-right: 8px; background: rgba(255,0,0,0.2); border: 1px solid #ff0000; color: #ff0000; font-size: 10px; border-radius: 4px; cursor: pointer;">LIMPIAR</button>
                        <button onclick="submitMemoryPattern()" style="padding: 12px; width: calc(100% - 100px); background: rgba(170,102,255,0.2); border: 1px solid #aa66ff; color: #aa66ff; font-weight: bold; font-size: 12px; border-radius: 4px; cursor: pointer;">‚úì ENVIAR</button>
                    </div>
                `;
            }

            return `
                <div class="daily-challenge-box" style="
                    border: 1px solid #aa66ff33;
                    background: rgba(170,102,255,0.05);
                    padding: 16px;
                    margin: 16px 0;
                    border-radius: 8px;
                    box-shadow: 0 0 20px rgba(170,102,255,0.2);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-size: 13px; color: #aa66ff; font-weight: bold;">
                            ${challengeNames[challenge.type]}
                        </div>
                        <div style="font-size: 10px; color: rgba(255,255,255,0.5);">
                            Intentos: ${state.dailyChallenge.attempts}/3
                        </div>
                    </div>
                    <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 16px;">
                        Completa el desaf√≠o y gana +10 minutos extra
                    </div>
                    ${challengeHTML}
                    <div id="challenge-feedback" style="margin-top: 12px; font-size: 11px; text-align: center;"></div>
                </div>
            `;
        }

        let userPattern = [];
        function addToPattern(emoji) {
            userPattern.push(emoji);
            document.getElementById('user-pattern').textContent = userPattern.join(' ');
        }

        function clearPattern() {
            userPattern = [];
            document.getElementById('user-pattern').textContent = '';
        }

        function submitMemoryPattern() {
            const result = checkChallengeAnswer(userPattern.join(','));
            showChallengeFeedback(result);
        }

        function submitChallengeAnswer(answerIndex) {
            const result = checkChallengeAnswer(answerIndex);
            showChallengeFeedback(result);
        }

        function submitChallengeAnswerText() {
            const answer = document.getElementById('challenge-answer').value;
            const result = checkChallengeAnswer(answer);
            showChallengeFeedback(result);
        }

        // Haptic Feedback for Mobile
        function vibrate(pattern) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        function showChallengeFeedback(result) {
            const feedback = document.getElementById('challenge-feedback');
            if (feedback) {
                // Haptic feedback
                if (result.success) {
                    vibrate([50, 30, 50]); // Success pattern: buzz-pause-buzz
                } else {
                    vibrate(100); // Error: single buzz
                }

                feedback.innerHTML = `
                    <div style="padding: 12px; background: rgba(${result.success ? '0,255,136' : '255,0,68'},0.1);
                                border: 1px solid ${result.success ? '#00ff88' : '#ff0044'};
                                border-radius: 4px; color: ${result.success ? '#00ff88' : '#ff0044'};
                                animation: slideUp 0.3s ease-out;">
                        ${result.message}
                    </div>
                `;
                setTimeout(() => {
                    render();
                }, 2000);
            }
        }

        function renderMainView() {
            const daysUntilTarget = getDaysUntilTarget();
            const progressPercent = (state.level / 90) * 100;
            const xpForNextLevel = (state.level * CONFIG.XP_PER_LEVEL) - state.xp;
            const randomMsg = MOTIVATIONAL_MESSAGES[Math.floor(Math.random() * MOTIVATIONAL_MESSAGES.length)];

            return `
                <div class="header">
                    <div class="header-subtitle">‚óà DIGITAL WELLNESS PROTOCOL ‚óà</div>
                    <h1 class="header-title" id="headerTitle">
                        LEVEL:<span class="header-level">11</span>
                    </h1>
                    <div class="header-target">// TARGET: iPHONE UNLOCK</div>
                </div>

                ${!state.todayCheckedIn ? `
                    <div class="motivational-msg">
                        ${randomMsg}
                    </div>
                ` : ''}

                <div class="progress-card">
                    <div class="corner tl"></div>
                    <div class="corner tr"></div>
                    <div class="corner bl"></div>
                    <div class="corner br"></div>

                    <div class="progress-labels">
                        <span style="color: rgba(255,255,255,0.5);">LVL.${state.level}</span>
                        <span style="color: #ff3366;">${state.level}/90 D√çAS</span>
                        <span style="color: rgba(255,255,255,0.5);">LVL.90</span>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%;">
                            <div class="progress-shine"></div>
                        </div>
                    </div>

                    <div class="progress-stats">
                        <span>XP: <span style="color: #00ff88;">${state.xp.toLocaleString()}</span></span>
                        <span>RACHA: <span style="color: #ffaa00;">${state.streak}d üî•</span></span>
                        <span>SIGUIENTE: <span style="color: #ff3366;">${xpForNextLevel} XP</span></span>
                    </div>
                </div>

                ${renderDailyChallenge()}

                ${renderDailyCheckin()}

                <div class="nav-grid">
                    <button class="nav-btn purple" onclick="changeView('achievements')">
                        <span class="nav-icon">‚óà</span>
                        LOGROS
                    </button>
                    <button class="nav-btn purple" onclick="changeView('history')">
                        <span class="nav-icon">‚ó´</span>
                        HISTORIAL
                    </button>
                    <button class="nav-btn purple" onclick="changeView('stats')">
                        <span class="nav-icon">‚ñ†</span>
                        STATS
                    </button>
                </div>

                <div class="target-section">
                    <div class="target-label">META FINAL</div>
                    <div class="target-date">12.03.2026</div>
                    <div class="target-status">
                        ${state.level >= CONFIG.TARGET_LEVEL
                            ? 'üéâ ¬°iPHONE 13 DESBLOQUEADO! üéâ'
                            : `Faltan ${CONFIG.TARGET_LEVEL - state.level} niveles para desbloquear el iPhone`}
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; color: rgba(255,255,255,0.3);">
                        ${daysUntilTarget} d√≠as restantes
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: center; font-size: 9px; color: rgba(255,255,255,0.15);">
                    /* system version ${CONFIG.VERSION} // location: HAWKINS */<br/>
                    D√≠a ${state.totalDays} del desaf√≠o
                </div>

                <div style="margin-top: 16px; text-align: center;">
                    <button onclick="toggleSound()" style="
                        background: rgba(0,0,0,0.6);
                        border: 1px solid ${SoundSystem.enabled ? '#00ff88' : 'rgba(255,255,255,0.2)'};
                        color: ${SoundSystem.enabled ? '#00ff88' : 'rgba(255,255,255,0.4)'};
                        padding: 8px 16px;
                        font-family: 'Courier New', monospace;
                        font-size: 10px;
                        cursor: pointer;
                        transition: all 0.3s;
                        border-radius: 4px;
                        letter-spacing: 1px;
                    ">
                        ${SoundSystem.enabled ? 'üîä SONIDO ON' : 'üîá SONIDO OFF'}
                    </button>
                </div>
            `;
        }

        function toggleSound() {
            const enabled = SoundSystem.toggle();
            if (enabled) {
                SoundSystem.play('click');
            }
            render();
        }

        function renderAchievementsView() {
            const allAchievements = [
                { key: 'first_login', ...getAchievementData('first_login') },
                { key: 'streak_3', ...getAchievementData('streak_3') },
                { key: 'streak_7', ...getAchievementData('streak_7') },
                { key: 'streak_14', ...getAchievementData('streak_14') },
                { key: 'streak_30', ...getAchievementData('streak_30') },
                { key: 'level_10', ...getAchievementData('level_10') },
                { key: 'level_25', ...getAchievementData('level_25') },
                { key: 'level_50', ...getAchievementData('level_50') },
                { key: 'level_75', ...getAchievementData('level_75') },
                { key: 'perfect_week', ...getAchievementData('perfect_week') },
                { key: 'mindflayer', ...getAchievementData('mindflayer') },
                { key: 'the_upside', ...getAchievementData('the_upside') }
            ];

            const unlockedCount = allAchievements.filter(a => state.achievements[a.key]).length;

            return `
                <button class="back-btn" onclick="changeView('main')">‚Üê VOLVER</button>

                <h2 class="view-title" style="color: #aa66ff; text-shadow: 0 0 20px rgba(138,43,226,0.5);">
                    ‚óà LOGROS (${unlockedCount}/${allAchievements.length}) ‚óà
                </h2>

                <div>
                    ${allAchievements.map(ach => `
                        <div class="achievement-item${state.achievements[ach.key] ? ' unlocked' : ''}">
                            <div class="achievement-icon${state.achievements[ach.key] ? ' unlocked' : ''}"
                                 style="color: ${state.achievements[ach.key] ? '#aa66ff' : 'rgba(255,255,255,0.3)'};">
                                ${ach.icon}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; font-size: 13px; letter-spacing: 1px; color: ${state.achievements[ach.key] ? '#fff' : 'rgba(255,255,255,0.5)'};">
                                    ${ach.name}
                                    ${state.achievements[ach.key] ? '<span style="margin-left: 10px; color: #00ff88; font-size: 10px;">[‚úì]</span>' : ''}
                                </div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.4); margin-top: 4px;">
                                    ${ach.desc}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="margin-top: 24px; padding: 16px; background: rgba(0,255,136,0.1); border: 1px solid rgba(0,255,136,0.3); text-align: center; font-size: 11px; color: rgba(255,255,255,0.8); border-radius: 4px;">
                    Sigue cumpliendo tus metas diarias para desbloquear m√°s logros üåü
                </div>
            `;
        }

        function renderHistoryView() {
            const last30Days = state.history.slice(-30);

            return `
                <button class="back-btn" onclick="changeView('main')">‚Üê VOLVER</button>

                <h2 class="view-title" style="color: #00aaff; text-shadow: 0 0 20px rgba(0,150,255,0.5);">
                    ‚ó´ HISTORIAL (${state.history.length} d√≠as) ‚ó´
                </h2>

                ${state.history.length === 0 ? `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.4);">
                        A√∫n no has registrado ning√∫n d√≠a.<br/>
                        ¬°Haz tu primer check-in para comenzar!
                    </div>
                ` : `
                    <div style="margin-bottom: 24px;">
                        ${last30Days.map(day => {
                            const statusColors = {
                                stable: '#00ff88',
                                alert: '#ffaa00',
                                breach: '#ff0044'
                            };
                            const color = statusColors[day.status];

                            return `
                                <div style="background: rgba(0,0,0,0.6); padding: 16px; margin-bottom: 8px; border-left: 4px solid ${color}; border-radius: 4px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span style="color: ${color}; font-weight: bold; font-size: 13px;">
                                            ${day.date}
                                        </span>
                                        <span style="color: #00ff88; font-size: 12px;">+${day.xp} XP</span>
                                    </div>
                                    <div style="font-size: 11px; color: rgba(255,255,255,0.6);">
                                        TikTok: ${day.stats.tiktok}min | IG: ${day.stats.instagram}min |
                                        Roblox: ${day.stats.roblox || 0}min | Desbloqueos: ${day.stats.unlocks}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div style="background: rgba(0,0,0,0.8); padding: 20px; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;">
                        <div style="font-size: 12px; letter-spacing: 2px; color: rgba(255,255,255,0.5); margin-bottom: 16px;">
                            ESTAD√çSTICAS GENERALES
                        </div>
                        <div style="font-size: 13px; color: rgba(255,255,255,0.8); line-height: 2;">
                            üìä Total d√≠as registrados: <span style="color: #00ff88;">${state.history.length}</span><br/>
                            üî• Racha actual: <span style="color: #ffaa00;">${state.streak} d√≠as</span><br/>
                            ‚ú® D√≠as perfectos: <span style="color: #00ff88;">${state.history.filter(d => d.status === 'stable').length}</span><br/>
                            ‚ö†Ô∏è D√≠as de alerta: <span style="color: #ffaa00;">${state.history.filter(d => d.status === 'alert').length}</span><br/>
                            üî¥ D√≠as cr√≠ticos: <span style="color: #ff0044;">${state.history.filter(d => d.status === 'breach').length}</span>
                        </div>
                    </div>
                `}
            `;
        }

        function renderStatsView() {
            const totalXP = state.xp;
            const avgXPPerDay = state.history.length > 0 ? Math.round(totalXP / state.history.length) : 0;
            const projectedLevel = state.history.length > 0 ? Math.floor((avgXPPerDay * 90) / CONFIG.XP_PER_LEVEL) : 0;

            return `
                <button class="back-btn" onclick="changeView('main')">‚Üê VOLVER</button>

                <h2 class="view-title" style="color: #00ff88; text-shadow: 0 0 20px rgba(0,255,136,0.5);">
                    ‚ñ† ESTAD√çSTICAS ‚ñ†
                </h2>

                <div style="background: rgba(0,0,0,0.8); padding: 20px; border: 1px solid rgba(0,255,136,0.3); margin-bottom: 16px; border-radius: 4px;">
                    <div style="font-size: 13px; letter-spacing: 2px; color: #00ff88; margin-bottom: 16px; text-align: center;">
                        PROGRESO ACTUAL
                    </div>
                    <div style="font-size: 24px; color: #fff; text-align: center; margin-bottom: 8px;">
                        NIVEL ${state.level}
                    </div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.6); text-align: center;">
                        ${state.xp.toLocaleString()} XP totales
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.8); padding: 20px; border: 1px solid rgba(255,170,0,0.3); margin-bottom: 16px; border-radius: 4px;">
                    <div style="font-size: 13px; letter-spacing: 2px; color: #ffaa00; margin-bottom: 16px; text-align: center;">
                        PROYECCI√ìN
                    </div>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.8); line-height: 2;">
                        üìà XP promedio por d√≠a: <span style="color: #00ff88;">${avgXPPerDay}</span><br/>
                        üéØ Nivel proyectado a 90 d√≠as: <span style="color: ${projectedLevel >= CONFIG.TARGET_LEVEL ? '#00ff88' : '#ffaa00'};">${projectedLevel}</span><br/>
                        ${projectedLevel >= CONFIG.TARGET_LEVEL
                            ? '‚úÖ <span style="color: #00ff88;">¬°VAS POR BUEN CAMINO!</span>'
                            : `‚ö†Ô∏è <span style="color: #ffaa00;">Necesitas ${Math.ceil((CONFIG.TARGET_LEVEL * CONFIG.XP_PER_LEVEL - avgXPPerDay * 90) / 90)} XP m√°s por d√≠a</span>`}
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.8); padding: 20px; border: 1px solid rgba(255,0,100,0.3); border-radius: 4px;">
                    <div style="font-size: 13px; letter-spacing: 2px; color: #ff3366; margin-bottom: 16px; text-align: center;">
                        L√çMITES
                    </div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.8); line-height: 2;">
                        üì± TikTok: m√°ximo <span style="color: #ff006e;">${state.limits.tiktok} minutos/d√≠a</span><br/>
                        üì∏ Instagram: m√°ximo <span style="color: #00d4ff;">${state.limits.instagram} minutos/d√≠a</span><br/>
                        üéÆ Roblox: m√°ximo <span style="color: #ffa500;">${state.limits.roblox} minutos/semana</span> (~2 partidas)<br/>
                        üîì Desbloqueos: m√°ximo <span style="color: #00ff88;">${state.limits.unlocks}/d√≠a</span><br/><br/>
                        <span style="font-size: 10px; color: rgba(255,255,255,0.5); font-style: italic;">
                        Mantente dentro de los l√≠mites para ganar XP m√°ximo cada d√≠a
                        </span>
                    </div>
                </div>
            `;
        }

        function showCelebration(title, message) {
            const modal = `
                <div class="modal-overlay" id="celebration">
                    <div class="modal-content" style="border: 2px solid #00ff88; box-shadow: 0 0 40px rgba(0,255,136,0.5);">
                        <div class="corner tl"></div>
                        <div class="corner tr"></div>
                        <div class="corner bl"></div>
                        <div class="corner br"></div>

                        <div style="font-size: 32px; margin-bottom: 16px; animation: celebration 0.5s;">
                            ‚ú®
                        </div>
                        <div style="font-size: 16px; letter-spacing: 3px; color: #00ff88; margin-bottom: 12px; text-shadow: 0 0 20px #00ff88;">
                            ${title}
                        </div>
                        <div style="font-size: 13px; color: rgba(255,255,255,0.8); margin-bottom: 24px; line-height: 1.6;">
                            ${message}
                        </div>
                        <button class="btn-confirm" style="width: 100%; padding: 14px;" onclick="closeCelebration()">
                            CONTINUAR
                        </button>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function closeCelebration() {
            const modal = document.getElementById('celebration');
            if (modal) modal.remove();
        }

        // Event handlers
        function changeView(view) {
            state.currentView = view;
            render();
            window.scrollTo(0, 0);
        }

        // Main render
        function render() {
            const app = document.getElementById('app');
            let content = '';

            if (state.currentView === 'main') {
                content = renderMainView();
            } else if (state.currentView === 'achievements') {
                content = renderAchievementsView();
            } else if (state.currentView === 'history') {
                content = renderHistoryView();
            } else if (state.currentView === 'stats') {
                content = renderStatsView();
            }

            app.innerHTML = content;

            // Handle memory pattern timer after rendering
            const memoryPattern = document.getElementById('memory-pattern');
            const memoryInput = document.getElementById('memory-input');
            if (memoryPattern && memoryInput) {
                setTimeout(() => {
                    memoryPattern.style.display = 'none';
                    memoryInput.style.display = 'block';
                }, 5000);
            }

            saveState();
        }

        // Persistence
        function saveState() {
            try {
                localStorage.setItem('level11_full', JSON.stringify(state));
            } catch (e) {
                console.error('Error saving state:', e);
            }
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('level11_full');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    Object.assign(state, loaded);

                    const today = getTodayKey();
                    const lastDay = state.history.length > 0 ? state.history[state.history.length - 1].date : null;

                    if (lastDay !== today) {
                        state.todayCheckedIn = false;
                        state.todayStats = { tiktok: 0, instagram: 0, roblox: 0, unlocks: 0 };
                    }
                }

                if (!state.achievements.first_login) {
                    state.achievements.first_login = true;
                    saveState();
                }
            } catch (e) {
                console.error('Error loading state:', e);
            }
        }

        // Effects
        function triggerGlitch() {
            const title = document.getElementById('headerTitle');
            if (title && Math.random() > 0.95) {
                title.classList.add('glitch');
                setTimeout(() => title.classList.remove('glitch'), 150);
            }
        }

        // Daily Reminder Notifications
        function scheduleDailyReminder() {
            if ('Notification' in window && Notification.permission === 'granted') {
                const now = new Date();
                const reminder = new Date();
                reminder.setHours(20, 0, 0, 0); // 8 PM reminder

                if (now > reminder) {
                    reminder.setDate(reminder.getDate() + 1);
                }

                const timeUntilReminder = reminder - now;

                setTimeout(() => {
                    if (!state.todayCheckedIn) {
                        new Notification('üéÆ LEVEL:11 - Check-in Diario', {
                            body: '¬°No olvides hacer tu check-in de hoy! üì±',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">üéÆ</text></svg>',
                            badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">üéÆ</text></svg>',
                            vibrate: [200, 100, 200]
                        });
                    }
                    // Schedule next day
                    scheduleDailyReminder();
                }, timeUntilReminder);
            }
        }

        function showDailyChallengeNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                if (!state.dailyChallenge.completed) {
                    new Notification('üéØ ¬°Desaf√≠o Diario Disponible!', {
                        body: '¬°Completa el desaf√≠o de hoy y gana +10 minutos extra! üéâ',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">üéØ</text></svg>',
                        vibrate: [100, 50, 100]
                    });
                }
            }
        }

        function init() {
            SoundSystem.init();
            loadState();
            render();

            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.opacity = '0';
                    setTimeout(() => loading.remove(), 300);
                }
            }, 500);

            setInterval(triggerGlitch, 2000);

            // Request notification permission (optional)
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission();
                }, 2000);
            }
        }

        // Start app
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
